<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Q-SYS Plugin Layout Editor</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="app">
    <!-- ── Toolbar ── -->
    <header id="toolbar">
      <div class="toolbar-row">
        <div class="toolbar-group" id="toolbar-file">
          <button id="btn-new" title="New Project">New</button>
          <button id="btn-save" title="Save Project (JSON)">Save</button>
          <button id="btn-load" title="Load Project (JSON)">Load</button>
          <input type="file" id="file-input" accept=".json" hidden>
        </div>
        <div class="toolbar-separator"></div>

        <div class="toolbar-group">
          <button id="btn-plugin-info" title="Edit PluginInfo">&#x1F6C8; PluginInfo</button>
          <button id="btn-pins" title="Edit Audio/Serial Pins">&#x1F50C; Pins</button>
          <button id="btn-design-props" title="Edit Design-Time Properties">&#x2699; Properties</button>
        </div>
        <div class="toolbar-separator"></div>

        <div class="toolbar-group">
          <button id="btn-settings" title="Application Settings">&#x2699; Settings</button>
          <button id="btn-help" title="Help">&#x2753; Help</button>
          <button id="btn-about" title="About">&#x2139; About</button>
        </div>
      </div>

      <div class="toolbar-row">
        <div class="toolbar-group" id="toolbar-alignment">
          <button id="btn-align-left" title="Align Left (Ctrl+Shift+Left)">&#x258C;L</button>
          <button id="btn-align-center-h" title="Align Center Horizontal">&#x2503;C</button>
          <button id="btn-align-right" title="Align Right (Ctrl+Shift+Right)">R&#x2590;</button>
          <button id="btn-align-top" title="Align Top (Ctrl+Shift+Up)">&#x2580;T</button>
          <button id="btn-align-center-v" title="Align Middle Vertical">&#x2501;M</button>
          <button id="btn-align-bottom" title="Align Bottom (Ctrl+Shift+Down)">B&#x2584;</button>
        </div>
        <div class="toolbar-separator"></div>

        <div class="toolbar-group" id="toolbar-distribute">
          <button id="btn-dist-h" title="Space Horizontally">&#x2194;S</button>
          <button id="btn-dist-v" title="Space Vertically">&#x2195;S</button>
          <button id="btn-space-even-h" title="Distribute Across Page (Horizontal)">&#x2194;D</button>
          <button id="btn-space-even-v" title="Distribute Across Page (Vertical)">&#x2195;D</button>
        </div>
        <div class="toolbar-separator"></div>

        <div class="toolbar-group" id="toolbar-sizing">
          <button id="btn-same-width" title="Make Same Width">W=</button>
          <button id="btn-same-height" title="Make Same Height">H=</button>
          <button id="btn-same-size" title="Make Same Size">WH=</button>
        </div>
        <div class="toolbar-separator"></div>

        <div class="toolbar-group" id="toolbar-pack">
          <button id="btn-pack-left" title="Pack Left">&#x25C0;&#x25C0;</button>
          <button id="btn-pack-right" title="Pack Right">&#x25B6;&#x25B6;</button>
          <button id="btn-pack-top" title="Pack Top">&#x25B2;&#x25B2;</button>
          <button id="btn-pack-bottom" title="Pack Bottom">&#x25BC;&#x25BC;</button>
        </div>
        <div class="toolbar-separator"></div>

        <div class="toolbar-group" id="toolbar-center-page">
          <button id="btn-center-page-h" title="Center on Page (Horizontal)">&#x2194;&#xD7;</button>
          <button id="btn-center-page-v" title="Center on Page (Vertical)">&#x2195;&#xD7;</button>
        </div>
        <div class="toolbar-separator"></div>

        <div class="toolbar-group" id="toolbar-zorder">
          <button id="btn-bring-front" title="Bring to Front (Ctrl+F)">&#x2191;F</button>
          <button id="btn-send-back" title="Send to Back (Ctrl+B)">&#x2193;B</button>
        </div>
      </div>
    </header>

    <!-- ── Settings Modal ── -->
    <div id="settings-overlay" class="modal-overlay" hidden>
      <div class="modal-dialog">
        <div class="modal-header">
          <h3>Settings</h3>
          <button id="settings-close" class="modal-close" title="Close">&times;</button>
        </div>
        <div class="modal-body">
          <div class="settings-section">
            <h4>New Control Defaults</h4>
            <div class="settings-row">
              <label>UserPin enabled by default</label>
              <input type="checkbox" id="setting-default-user-pin" checked>
            </div>
            <div class="settings-row">
              <label>Default PinStyle</label>
              <select id="setting-default-pin-style">
                <option value="Input">Input</option>
                <option value="Output">Output</option>
                <option value="Both" selected>Both</option>
                <option value="None">None</option>
              </select>
            </div>
            <div class="settings-row">
              <label>Auto-add label to new controls</label>
              <input type="checkbox" id="setting-auto-add-label">
            </div>
            <div class="settings-row">
              <label>Alignment anchor</label>
              <select id="setting-alignment-anchor">
                <option value="first">First selected</option>
                <option value="last">Last selected</option>
              </select>
            </div>
          </div>
          <div class="settings-section">
            <h4>Code Generation</h4>
            <div class="settings-row">
              <label>Author Name</label>
              <input type="text" id="setting-author-name" placeholder="Your name">
            </div>
            <div class="settings-row">
              <label>Auto-generate Status control</label>
              <input type="checkbox" id="setting-auto-generate-status">
            </div>
          </div>
          <div class="settings-section">
            <h4>Grid & Canvas Defaults</h4>
            <div class="settings-row">
              <label>Grid Size (px)</label>
              <input type="number" id="setting-grid-size" value="10" min="1" max="100">
            </div>
            <div class="settings-row">
              <label>Snap to Grid</label>
              <input type="checkbox" id="setting-snap" checked>
            </div>
            <div class="settings-row">
              <label>Show Grid</label>
              <input type="checkbox" id="setting-show-grid" checked>
            </div>
            <div class="settings-row">
              <label>Default Target Width</label>
              <input type="number" id="setting-canvas-width" value="400" min="50" max="4000">
            </div>
            <div class="settings-row">
              <label>Default Target Height</label>
              <input type="number" id="setting-canvas-height" value="300" min="50" max="4000">
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button id="settings-save" class="btn-primary">Save</button>
          <button id="settings-cancel">Cancel</button>
        </div>
      </div>
    </div>

    <!-- ── About Modal ── -->
    <div id="about-overlay" class="modal-overlay" hidden>
      <div class="modal-dialog" style="max-width:440px">
        <div class="modal-header">
          <h3>About</h3>
          <button id="about-close" class="modal-close" title="Close">&times;</button>
        </div>
        <div class="modal-body about-body">
          <h4>Q-SYS Plugin Layout Editor</h4>
          <p class="about-version">Version 1.0.0</p>
          <p>A visual editor for designing Q-SYS plugin control layouts. Drag controls and graphics onto the canvas, configure their properties, and the editor generates the boilerplate Lua code for you.</p>
          <p class="about-privacy">All project data is stored locally on your computer. Nothing is sent to or stored on any server.</p>
          <p class="about-disclaimer">Not affiliated with, endorsed by, or sponsored by QSC, LLC, Q-SYS, or Acuity Brands.</p>
          <p class="about-copyright">&copy; 2026 Jonathan Dean</p>
          <p class="about-repo"><a href="https://github.com/ke4ukz/QSYSPluginLayout" target="_blank">github.com/ke4ukz/QSYSPluginLayout</a></p>
          <p class="about-license">This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version. This program is distributed without any warranty; see the <a href="COPYING" target="_blank">GNU GPL v3</a> for details.</p>
        </div>
        <div class="modal-footer">
          <button id="about-ok" class="btn-primary">OK</button>
        </div>
      </div>
    </div>

    <!-- ── PluginInfo Modal ── -->
    <div id="plugininfo-overlay" class="modal-overlay" hidden>
      <div class="modal-dialog" style="max-width:500px">
        <div class="modal-header">
          <h3>PluginInfo</h3>
          <button id="plugininfo-close" class="modal-close" title="Close">&times;</button>
        </div>
        <div class="modal-body">
          <div class="settings-section">
            <h4>Required</h4>
            <div class="settings-row">
              <label>Name <span class="required-tag">required</span></label>
              <input type="text" id="pi-name" placeholder="FolderName~PluginName">
            </div>
            <div class="settings-row">
              <label>Version <span class="required-tag">required</span></label>
              <input type="text" id="pi-version" placeholder="1.0.0">
            </div>
            <div class="settings-row">
              <label>Id <span class="required-tag">required</span></label>
              <div class="pi-id-group">
                <input type="text" id="pi-id" placeholder="qsysc.make.model.version">
                <button id="pi-generate-id" title="Generate UUID">UUID</button>
              </div>
            </div>
          </div>
          <div class="settings-section">
            <h4>Optional</h4>
            <div class="settings-row">
              <label>Description</label>
              <input type="text" id="pi-description" placeholder="Brief description">
            </div>
            <div class="settings-row">
              <label>BuildVersion</label>
              <input type="text" id="pi-build-version" placeholder="Build iteration">
            </div>
            <div class="settings-row">
              <label>Author</label>
              <input type="text" id="pi-author" placeholder="Author name or contact">
            </div>
            <div class="settings-row">
              <label>Manufacturer</label>
              <input type="text" id="pi-manufacturer" placeholder="Hardware manufacturer">
            </div>
            <div class="settings-row">
              <label>Model</label>
              <input type="text" id="pi-model" placeholder="Product model name">
            </div>
            <div class="settings-row">
              <label>IsManaged</label>
              <input type="checkbox" id="pi-is-managed">
            </div>
            <div class="settings-row">
              <label>Type</label>
              <input type="text" id="pi-type" placeholder="Reflect reporting type">
            </div>
            <div class="settings-row">
              <label>ShowDebug</label>
              <input type="checkbox" id="pi-show-debug">
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button id="plugininfo-clear">Clear</button>
          <button id="plugininfo-save" class="btn-primary">Save</button>
          <button id="plugininfo-cancel">Cancel</button>
        </div>
      </div>
    </div>

    <!-- ── Pins Modal ── -->
    <div id="pins-overlay" class="modal-overlay" hidden>
      <div class="modal-dialog" style="max-width:520px">
        <div class="modal-header">
          <h3>Audio / Serial Pins</h3>
          <button id="pins-close" class="modal-close" title="Close">&times;</button>
        </div>
        <div class="modal-body">
          <p class="pins-hint">Define audio and serial pins for the plugin. Pins are audio by default.</p>
          <div id="pins-list"></div>
          <button id="pins-add" class="combobox-add-btn">+ Add Pin</button>
        </div>
        <div class="modal-footer">
          <button id="pins-clear">Clear All</button>
          <button id="pins-save" class="btn-primary">Save</button>
          <button id="pins-cancel">Cancel</button>
        </div>
      </div>
    </div>

    <!-- ── Design-Time Properties Modal ── -->
    <div id="designprops-overlay" class="modal-overlay" hidden>
      <div class="modal-dialog" style="max-width:560px">
        <div class="modal-header">
          <h3>Design-Time Properties</h3>
          <button id="designprops-close" class="modal-close" title="Close">&times;</button>
        </div>
        <div class="modal-body">
          <p class="pins-hint">Define properties shown in Q-SYS Designer's properties pane. A stub RectifyProperties will also be generated.</p>
          <div id="designprops-list"></div>
          <button id="designprops-add" class="combobox-add-btn">+ Add Property</button>
        </div>
        <div class="modal-footer">
          <button id="designprops-clear">Clear All</button>
          <button id="designprops-save" class="btn-primary">Save</button>
          <button id="designprops-cancel">Cancel</button>
        </div>
      </div>
    </div>

    <!-- ── Toolbox (left panel) ── -->
    <aside id="toolbox">
      <h3>Controls</h3>
      <div class="toolbox-section" id="toolbox-controls">
        <div class="toolbox-item" data-object-kind="control" data-type="Button" draggable="true">
          <span class="toolbox-icon">&#x25A3;</span> Button        </div>
        <div class="toolbox-item" data-object-kind="control" data-type="Knob" draggable="true">
          <span class="toolbox-icon">&#x25CE;</span> Knob / Fader        </div>
        <div class="toolbox-item" data-object-kind="control" data-type="Indicator" draggable="true">
          <span class="toolbox-icon">&#x25CF;</span> Indicator        </div>
        <div class="toolbox-item" data-object-kind="control" data-type="Text" draggable="true">
          <span class="toolbox-icon">&#x25AD;</span> Text        </div>
      </div>
      <h3>Graphics</h3>
      <div class="toolbox-section" id="toolbox-graphics">
        <div class="toolbox-item" data-object-kind="graphic" data-type="Label" draggable="true">
          <span class="toolbox-icon">A</span> Label        </div>
        <div class="toolbox-item" data-object-kind="graphic" data-type="GroupBox" draggable="true">
          <span class="toolbox-icon">&#x25A1;</span> GroupBox        </div>
        <div class="toolbox-item" data-object-kind="graphic" data-type="Header" draggable="true">
          <span class="toolbox-icon">&#x2501;</span> Header        </div>
        <div class="toolbox-item" data-object-kind="graphic" data-type="image" draggable="true">
          <span class="toolbox-icon">&#x25A4;</span> Image
        </div>
        <div class="toolbox-item" data-object-kind="graphic" data-type="svg" draggable="true">
          <span class="toolbox-icon">&lt;/&gt;</span> SVG
        </div>
      </div>
    </aside>

    <!-- ── Canvas (center) ── -->
    <main id="canvas-container">
      <div id="canvas-viewport">
        <div id="canvas">
          <div id="target-size-rect"></div>
          <div id="bounding-box-rect"><span class="bbox-label"></span></div>
          <div id="selection-rect" hidden></div>
        </div>
      </div>
    </main>

    <!-- ── Properties Panel (right) ── -->
    <aside id="properties-panel">
      <h3>Properties</h3>
      <div id="properties-content">
        <p class="placeholder-text">Select an object to edit its properties.</p>
      </div>
    </aside>

    <!-- ── Lua Output (bottom) ── -->
    <footer id="lua-panel">
      <div id="lua-panel-header">
        <h3>Lua Output</h3>
        <button id="btn-generate-lua" title="Generate Lua code">Generate</button>
        <button id="btn-copy-lua" title="Copy to clipboard">Copy</button>
        <button id="btn-maximize-lua" title="Maximize / Restore">&#x2922;</button>
        <button id="btn-toggle-lua" title="Collapse / Expand">&#x25BC;</button>
      </div>
      <pre id="lua-output-wrap"><code id="lua-output"></code></pre>
    </footer>
  </div>

  <script>
    // Emergency reset: append ?reset=true to the URL to wipe all localStorage
    if (new URLSearchParams(location.search).get('reset') === 'true') {
      localStorage.clear();
      location.replace(location.pathname);
    }
  </script>
  <script type="module" src="js/main.js"></script>
</body>
</html>
